<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeu des drapeaux</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <img class="drapeau" id="image" src="">
    <div class="container">
        <button class="btn-1" id="reponse1" onclick="choix('r1')">Réponse 1</button>
        <button class="btn-2" id="reponse2" onclick="choix('r2')">Réponse 2</button>
        <button class="btn-3" id="reponse3" onclick="choix('r3')">Réponse 3</button>
        <button class="btn-4" id="reponse4" onclick="choix('r4')">Réponse 4</button>
    </div>
</body>




<script>
    const socket = new WebSocket('ws://localhost:8001');
    var num_v = 0;
    var num_j = 0;
    var repp = '';



    choix = function(rep) {
        socket.send(JSON.stringify({"action":"jeux","valeur":rep}));
        repp = rep
    }

    commencer = function() {
        socket.send(JSON.stringify({"action":"commencer"}));
        num_j = num_j + 1;
        for (let i = 1; i < 5; i++) {document.getElementById("reponse"+i).style.background='#33ACFF';}
    }


    socket.onopen = function() {
        var t = setInterval(function() {
            socket.send(JSON.stringify({
                "action": "vivant",
                "valeur":""
            }));
        }, 55000);
        commencer();
    };

    socket.onmessage = function(event) {
        var reponse = JSON.parse(event.data);
        if (reponse['action'] == 'jeux_question'){
            document.getElementById("image").src = reponse['valeur']['lien']
            for (let i = 1; i < 5; i++) {document.getElementById("reponse"+i).innerText = reponse['valeur']['r'+i];}
        };
        if (reponse['action'] == 'jeux_reponse'){
            if (reponse['valeur'] == repp){
                num_v = num_v + 1         
            }
            for (let i = 1; i < 5; i++) { document.getElementById("reponse"+i).style.background='#FF0000';}   
            document.getElementById("reponse"+reponse['valeur'].slice(1)).style.background='#00FF00';
            setTimeout(() => { commencer(); }, 1500); 

        }
        //document.getElementById('vf').innerText = num_v + "/" + num_j + "parties gagnées.";


    }

</script>


</html>